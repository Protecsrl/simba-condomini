CREATE OR REPLACE VIEW V_IMPIANTO_APPARATO AS
SELECT imp.oid codice,
            imp.oid impianto,
            count (app.oid) countapparati ,
            sum (smp.tempo)   AS SumTemposchedeMP,    
            'Apparati('|| count (app.oid) ||')Totale Carico: ore:'||   
          Floor( sum (smp.tempo)/60 ) 
          
         -- || '-'||    (sum (smp.tempo)/60) - Floor( sum (smp.tempo)/60 )
           -- -  Floor( sum (smp.tempo)/60 ) 
           
            AS DescrizioneCarico     
                                            
       FROM apparato app,                                         
            impianto imp,
            Apparatoschedamp asmp,
            schedemp smp
            
      WHERE     app.impianto = imp.oid
      and       asmp.apparato = app.oid
      and       smp.oid=asmp.schedamp
      --and imp.oid <35
            
      
   GROUP BY  imp.oid,
            imp.oid
;
